<!DOCTYPE html>
<html lang="de">

<head>
   <meta charset="UTF-8">
   <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
   >
   <title>SHOWTOOL</title>
   <script src="static/tailwind.js"></script>
   <link
      href="static/flowbite.css"
      rel="stylesheet"
   />
   <script src="static/vue.js"></script>
</head>

<body class="bg-gray-100 h-screen p-4">
   <div
      id="app"
      class="antialiased bg-gray-50"
      v-cloak
   >
      <nav class="bg-white border-b border-gray-200 px-4 py-2.5 fixed left-0 right-0 top-0 z-50">
         <div class="flex flex-wrap justify-between items-center">
            <div class="flex justify-start items-center">
               <h1 class="text-3xl font-bold pr-8">MANUELLE SHOW</h1>
               <div>
                  <span
                     id="online-status"
                     class="inline-flex items-center px-2 py-1 me-2 text-sm font-medium text-green-800 bg-green-100 rounded"
                     :class="{'opacity-100': isConnected, 'opacity-10': !isConnected}"
                  >
                     Online
                  </span>
                  <span
                     id="offline-status"
                     class="inline-flex items-center px-2 py-1 me-2 text-sm font-medium text-red-800 bg-red-100 rounded"
                     :class="{'opacity-100': !isConnected, 'opacity-10': isConnected}"
                  >
                     Offline
                  </span>
               </div>
            </div>
         </div>
      </nav>

      <main class="p-4 h-auto pt-20">
         <div class="flex justify-between items-center mb-8">
            <button
               class="bg-blue-500 text-white px-4 py-2 rounded"
               onclick="window.history.back();"
            >
               Zurück
            </button>
         </div>

         <!-- System Commands -->
         <div class="mb-8">
            <h3 class="text-xl font-bold mb-4">System-Befehle</h3>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
               <div class="flex flex-wrap gap-4">
                  <button
                     v-for="cmd in stateCommands"
                     :key="cmd.id"
                     class="text-white px-6 py-3 rounded font-bold"
                     :class="{
                        'bg-red-500 hover:bg-red-600': cmd.color === 'red',
                        'bg-yellow-500 hover:bg-yellow-600': cmd.color === 'yellow',
                        'bg-green-500 hover:bg-green-600': cmd.color === 'green',
                        'bg-orange-500 hover:bg-orange-600': cmd.color === 'orange',
                        'bg-gray-500 hover:bg-gray-600': cmd.color === 'gray'
                     }"
                     @click="sendEffect(cmd.id)"
                  >
                     {{ cmd.name }}
                  </button>
               </div>
            </div>
         </div>

         <!-- Global Color Control -->
         <div class="mb-8">
            <h3 class="text-xl font-bold mb-4">Farb- und Effekt-Steuerung</h3>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
               <div class="flex flex-wrap gap-8">
                  <!-- Color Preview & RGB -->
                  <div class="flex gap-4 items-start">
                     <div
                        class="w-24 h-24 rounded-lg border-2 border-gray-400"
                        :style="{ backgroundColor: `rgb(${red}, ${green}, ${blue})` }"
                     ></div>
                     <div class="flex flex-col gap-2">
                        <div class="flex items-center">
                           <label class="w-16 text-red-600 font-bold">R:</label>
                           <input
                              type="range"
                              v-model="red"
                              min="0"
                              max="255"
                              class="w-32"
                           >
                           <input
                              type="number"
                              v-model="red"
                              min="0"
                              max="255"
                              class="w-16 ml-2 text-center border rounded"
                           >
                        </div>
                        <div class="flex items-center">
                           <label class="w-16 text-green-600 font-bold">G:</label>
                           <input
                              type="range"
                              v-model="green"
                              min="0"
                              max="255"
                              class="w-32"
                           >
                           <input
                              type="number"
                              v-model="green"
                              min="0"
                              max="255"
                              class="w-16 ml-2 text-center border rounded"
                           >
                        </div>
                        <div class="flex items-center">
                           <label class="w-16 text-blue-600 font-bold">B:</label>
                           <input
                              type="range"
                              v-model="blue"
                              min="0"
                              max="255"
                              class="w-32"
                           >
                           <input
                              type="number"
                              v-model="blue"
                              min="0"
                              max="255"
                              class="w-16 ml-2 text-center border rounded"
                           >
                        </div>
                     </div>
                  </div>

                  <!-- Effect Parameters -->
                  <div class="flex flex-col gap-2">
                     <div class="flex items-center">
                        <label class="w-24">Intensität:</label>
                        <input
                           type="range"
                           v-model="intensity"
                           min="0"
                           max="255"
                           class="w-32"
                        >
                        <input
                           type="number"
                           v-model="intensity"
                           min="0"
                           max="255"
                           class="w-16 ml-2 text-center border rounded"
                        >
                     </div>
                     <div class="flex items-center">
                        <label class="w-24">Speed (ms):</label>
                        <input
                           type="range"
                           v-model="speed"
                           min="10"
                           max="2000"
                           class="w-32"
                        >
                        <input
                           type="number"
                           v-model="speed"
                           min="10"
                           max="10000"
                           class="w-16 ml-2 text-center border rounded"
                        >
                     </div>
                     <div class="flex items-center">
                        <label class="w-24">Länge:</label>
                        <input
                           type="range"
                           v-model="length"
                           min="1"
                           max="50"
                           class="w-32"
                        >
                        <input
                           type="number"
                           v-model="length"
                           min="1"
                           max="255"
                           class="w-16 ml-2 text-center border rounded"
                        >
                     </div>
                  </div>
               </div>
            </div>
         </div>

         <!-- LED Effects Grid -->
         <div class="mb-8">
            <h3 class="text-xl font-bold mb-4">LED-Effekte</h3>
            <div class="border-2 border-dashed border-gray-300 rounded-lg p-4">
               <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-3">
                  <button
                     v-for="effect in effects"
                     :key="effect.id"
                     class="p-4 border-2 rounded-lg hover:bg-blue-100 hover:border-blue-500 transition-colors"
                     :class="{ 'bg-blue-50 border-blue-400': selectedEffect === effect.id }"
                     @click="selectAndSendEffect(effect)"
                  >
                     <div class="font-bold text-sm">{{ effect.name }}</div>
                     <div class="text-xs text-gray-500 mt-1">0x{{ effect.id.toString(16).toUpperCase() }}</div>
                  </button>
               </div>
            </div>
         </div>
      </main>
   </div>


   <script src="./static/flowbite.min.js"></script>

   <script type="module">
      const { createApp } = Vue

      const app = createApp({
         data () {
            return {
               environment: localStorage.getItem('environment') || 'samuels-macbook-pro.local:8000',
               isConnected: false,
               socket: null,
               selectedEffect: null,
               red: 255,
               green: 255,
               blue: 255,
               intensity: 255,
               speed: 100,
               length: 4,
               // LED-Effekte (0x20-0x2F)
               effects: [
                  {
                     id: 0x20,
                     name: 'Solid',
                     description: 'Statische Farbe',
                     hasIntensity: true
                  },
                  {
                     id: 0x21,
                     name: 'Blink',
                     description: 'Blinken',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x22,
                     name: 'Fade',
                     description: 'Ein-/Ausfaden',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x23,
                     name: 'Rainbow',
                     description: 'Regenbogen',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x24,
                     name: 'Rainbow Cycle',
                     description: 'Regenbogen-Zyklus',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x25,
                     name: 'Chase',
                     description: 'Lauflicht',
                     hasIntensity: true,
                     hasSpeed: true,
                     hasLength: true
                  },
                  {
                     id: 0x26,
                     name: 'Theater Chase',
                     description: 'Theater-Lauflicht',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x27,
                     name: 'Twinkle',
                     description: 'Funkeln',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x28,
                     name: 'Sparkle',
                     description: 'Glitzern',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x29,
                     name: 'Fire',
                     description: 'Feuer-Effekt',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x2A,
                     name: 'Pulse',
                     description: 'Pulsieren',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x2B,
                     name: 'Strobe',
                     description: 'Stroboskop',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x2C,
                     name: 'Gradient',
                     description: 'Farbverlauf',
                     hasIntensity: true,
                     hasSpeed: true
                  },
                  {
                     id: 0x2D,
                     name: 'Wave',
                     description: 'Welle',
                     hasIntensity: true,
                     hasSpeed: true,
                     hasLength: true
                  },
                  {
                     id: 0x2E,
                     name: 'Meteor',
                     description: 'Meteor/Sternschnuppe',
                     hasIntensity: true,
                     hasSpeed: true,
                     hasLength: true
                  },
                  {
                     id: 0x2F,
                     name: 'Breathing',
                     description: 'Atmen (langsames Pulsieren)',
                     hasIntensity: true,
                     hasSpeed: true
                  }
               ],
               // State-Commands (0x10-0x14)
               stateCommands: [
                  { id: 0x10, name: 'Aus', color: 'red' },
                  { id: 0x11, name: 'Standby', color: 'yellow' },
                  { id: 0x12, name: 'Aktiv', color: 'green' },
                  { id: 0x13, name: 'Notfall', color: 'orange' },
                  { id: 0x14, name: 'Blackout', color: 'gray' }
               ]
            }
         },

         methods: {
            connectWebSocket () {
               this.socket = new WebSocket(`ws://${this.environment}/ws`)

               this.socket.addEventListener('open', () => {
                  this.isConnected = true
               })

               this.socket.addEventListener('close', () => {
                  this.isConnected = false
                  setTimeout(() => this.connectWebSocket(), 5000)
               })
            },

            selectAndSendEffect (effect) {
               this.selectedEffect = effect.id
               this.sendEffect(effect.id)
            },

            sendEffect (effectId) {
               const command = {
                  effect: Number(effectId),
                  intensity: Number(this.intensity),
                  red: Number(this.red),
                  green: Number(this.green),
                  blue: Number(this.blue),
                  speed: Number(this.speed),
                  length: Number(this.length)
               }

               fetch(`http://${this.environment}/command`, {
                  method: 'POST',
                  headers: {
                     'Content-Type': 'application/json',
                  },
                  body: JSON.stringify(command)
               })
            }
         },

         mounted () {
            this.connectWebSocket()
         }
      })

      app.mount('#app')
   </script>
</body>

</html>
